---
title: "ECON 470 Homework 1"
author: "Srijon Sarkar"
date: "January 23, 2026"
jupyter: ir
---

**Setup**:
- Created the hwk1 repository with a `.gitignore` file to avoid large data file commits, and synced the SSH key from OpenDemand onto GitHub.
- Structured the hwk1 directory into subfolders of the first and second submission, with analysis, data-code, and results. (The second one primarily contains the main work)
- Extracted the data only for 2018 as desired from enrollment and service area data of the large MA dataset. (Codes under submission 2 folder, data-code subfolder).

```{r}
library("rmarkdown")
library("tidyverse")
library("dplyr")
```

```{r}
setwd('/home/ssark38/econ470/a0/work/hwk1')
```

```{r}
plan_data <- read_csv("data/plan_data.csv")
```

```{r}
service_data <- read_csv("data/service_data.csv")
```

## Exercise 1

Here we count the number of plans under each plan type:

```{r}
table1 <- plan_data %>%
    distinct(contractid, planid, plan_type) %>%
    count(plan_type, name = "n_plans")

table1
```

## Exercise 2

Now, we remove all special needs plans (SNP), employer group plans (eghp), and all “800-series” plans as follows:

```{r}
filtered_plans <- plan_data %>%
    filter(
        snp == "No",
        eghp == "No",
        !(planid >= 800 & planid < 900)
    )
```

```{r}
updated_table1 <- filtered_plans %>%
    distinct(contractid, planid, plan_type) %>%
    count(plan_type, name = "n_plans")

updated_table1
```

## Exercise 3

Finally, before merge we filter the data county-wise in the service area to avoid double-counting in the mean calculation, as a plan spans over several months 

```{r}
filtered_service <- service_data %>%
    filter(!is.na(fips)) %>%
    distinct(contractid, fips, year)
```

As the contract ID uniquely identifies the plan group and FIPS assists in the choice of counties, we use those as primary keys for the merge with year for 2018 as a precautionary measure, though only 2018 data was extracted. 

```{r}
merged_data <- filtered_plans %>%
  inner_join(filtered_service, 
             by = c("contractid", "fips", "year"))
```

```{r}
glimpse(merged_data)
```

```{r}
write_csv(merged_data, "data/intermediate_data.csv")
```

Finally, considering counties in which plans are approved as per the service area files, we get a table of the average enrollments for each plan type

```{r}
table2 <- merged_data %>%
  group_by(plan_type) %>%
  summarise(avg_enrollment = mean(avg_enrollment, na.rm = TRUE),
           .groups="drop") %>%
  arrange(desc(avg_enrollment))

table2
```
